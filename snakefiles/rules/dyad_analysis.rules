

# Check/set parameters
if not "qsub" in config.keys():
    sys.exit("The parameter qsub must be defined in the config file")

# Rule
rule dyad_analysis:
    """Motif discovery using the dyad-analysis pipeline.

    Find out more @ http://floresta.eead.csic.es/rsat/help.dyad-analysis.html

    Required parameters:
        config["qsub"]

    Contributors: Claire Rioualen, Jacques van Helden 
    """
    input:
        purged = "{dir}/purge-sequence/{TF}_{sites}.fasta.purged"
    output: 
        txt = "{dir}/dyad-analysis/{TF}_{sites}_report.txt",
    params:
        qsub = config["qsub"] + " -e {dir}/dyad-analysis/{TF}_{sites}_qsub.err" \
                  + " -o {dir}/dyad-analysis/{TF}_{sites}_qsub.out" 
    log: "{dir}/dyad-analysis/{TF}_{sites}_dyad-analysis.log"
    benchmark: "{dir}/dyad-analysis/{TF}_{sites}_dyad-analysis_benchmark.txt"
#    conda: "../envs/dyad_analysis.yaml"
    shell:"""
dyad-analysis -i {input.purged} -v 1 -quick -sort -timeout 3600  -type any -2str -noov -lth occ 0 -uth occ 1 -lth occ_sig 0 -uth rank 50 -return occ,proba,rank -l 3 -spacing 0-20 > {output.txt}
"""

# purge-sequence -i peaks/CpxR/CpxR_BS.fasta -format fasta -o peaks/CpxR/CpxR_BS.fasta.purged;
# dyad-analysis -i peaks/CpxR/CpxR_BS.fasta.purged -v 1 -quick -sort -timeout 3600  -type any -2str -noov -lth occ 0 -uth occ 1 -lth occ_sig 0 -uth rank 50 -return occ,proba,rank -l 3 -spacing 0-20



